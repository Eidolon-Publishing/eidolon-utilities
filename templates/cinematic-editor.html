<div class="cinematic-editor">
  {{!-- Toolbar --}}
  <header class="cinematic-editor__toolbar">
    <div class="cinematic-editor__toolbar-left">
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon"
              data-action="play-preview" title="Preview"><i class="fa-solid fa-play"></i></button>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon"
              data-action="undo" title="Undo (Ctrl+Z)" {{#unless canUndo}}disabled{{/unless}}><i class="fa-solid fa-arrow-rotate-left"></i></button>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon"
              data-action="redo" title="Redo (Ctrl+Shift+Z)" {{#unless canRedo}}disabled{{/unless}}><i class="fa-solid fa-arrow-rotate-right"></i></button>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon"
              data-action="validate" title="Validate"><i class="fa-solid fa-circle-check"></i></button>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon"
              data-action="open-tracking" title="Tracking"><i class="fa-solid fa-eye"></i></button>
    </div>
    <span class="cinematic-editor__scene-name">{{sceneName}}</span>
    <div class="cinematic-editor__toolbar-right">
      <button type="button" class="cinematic-editor__btn{{#if dirty}} cinematic-editor__btn--accent{{/if}}"
              data-action="save">Save</button>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon"
              data-action="export-json" title="Copy JSON"><i class="fa-solid fa-clipboard"></i></button>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon"
              data-action="import-json" title="Import JSON"><i class="fa-solid fa-file-import"></i></button>
    </div>
  </header>

  {{!-- Cinematic selector bar --}}
  <div class="cinematic-editor__cinematic-bar">
    <select data-action="change-cinematic" class="cinematic-editor__cinematic-select">
      {{#each cinematicOptions}}
      <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
      {{/each}}
    </select>
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon cinematic-editor__btn--small"
            data-action="add-cinematic" title="New cinematic"><i class="fa-solid fa-plus"></i></button>
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon cinematic-editor__btn--small"
            data-action="rename-cinematic" title="Rename"><i class="fa-solid fa-pen"></i></button>
    {{#if hasMultipleCinematics}}
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon cinematic-editor__btn--small cinematic-editor__btn--danger"
            data-action="remove-cinematic" title="Remove"><i class="fa-solid fa-trash"></i></button>
    {{/if}}
  </div>

  {{!-- Segment graph --}}
  <div class="cinematic-editor__segment-graph-area">
    <div class="cinematic-editor__segment-graph" style="width: {{segmentGraph.totalWidthPx}}px;">
      {{#each segmentGraph.nodes}}
      <div class="cinematic-editor__segment-node {{#if isActive}}cinematic-editor__segment-node--active{{/if}} {{#if isEntry}}cinematic-editor__segment-node--entry{{/if}} {{#if isOrphan}}cinematic-editor__segment-node--orphan{{/if}}"
           style="left: {{leftPx}}px; width: {{widthPx}}px;"
           data-action="select-segment" data-segment-name="{{name}}">
        <span class="cinematic-editor__segment-node-name">{{name}}</span>
        <span class="cinematic-editor__segment-node-duration">{{durationLabel}}</span>
        {{#if hasGate}}<i class="fa-solid fa-lock cinematic-editor__segment-node-gate" title="Gate: {{gateEvent}}"></i>{{/if}}
      </div>
      {{/each}}

      {{#each segmentGraph.edges}}
      <div class="cinematic-editor__segment-edge {{#if isCrossScene}}cinematic-editor__segment-edge--cross-scene{{/if}}"
           style="left: {{fromRightPx}}px; width: {{toLeftPx}}px;">
        <div class="cinematic-editor__segment-edge-line"></div>
        {{#if gateLabel}}<span class="cinematic-editor__segment-edge-label">{{gateLabel}}</span>{{/if}}
      </div>
      {{/each}}
    </div>
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon cinematic-editor__btn--small cinematic-editor__segment-add-btn"
            data-action="add-segment" title="Add segment"><i class="fa-solid fa-plus"></i></button>
  </div>

  {{!-- Segment detail bar --}}
  <div class="cinematic-editor__segment-detail-bar">
    <span class="cinematic-editor__segment-detail-name">{{activeSegmentName}}</span>
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon cinematic-editor__btn--small"
            data-action="rename-segment" data-segment-name="{{activeSegmentName}}" title="Rename segment"><i class="fa-solid fa-pen"></i></button>
    {{#if hasMultipleSegments}}
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--icon cinematic-editor__btn--small cinematic-editor__btn--danger"
            data-action="remove-segment" data-segment-name="{{activeSegmentName}}" title="Remove segment"><i class="fa-solid fa-trash"></i></button>
    {{/if}}
    <span style="flex:1"></span>

    {{!-- Gate config --}}
    <label class="cinematic-editor__config-item">
      <span>Gate</span>
      <select data-action="change-gate-event">
        <option value="" {{#unless activeSegmentGate}}selected{{/unless}}>(none)</option>
        <option value="click" {{#if (eq activeSegmentGate.event "click")}}selected{{/if}}>Click</option>
        <option value="tile-click" {{#if (eq activeSegmentGate.event "tile-click")}}selected{{/if}}>Tile Click</option>
        <option value="keypress" {{#if (eq activeSegmentGate.event "keypress")}}selected{{/if}}>Keypress</option>
      </select>
    </label>
    {{#if activeSegmentGate}}
    {{#if (eq activeSegmentGate.event "tile-click")}}
    <label class="cinematic-editor__config-item">
      <span>Target</span>
      <div class="cinematic-editor__target-group">
        <input type="text" data-action="change-gate-target" value="{{activeSegmentGate.target}}" placeholder="tag:my-button" style="width:120px" />
        <button type="button" class="cinematic-editor__btn--icon" data-action="pick-gate-target" title="Pick from canvas">
          <i class="fa-solid fa-crosshairs"></i>
        </button>
      </div>
    </label>
    {{/if}}
    {{/if}}

    {{!-- Segment setup/landing --}}
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
            data-action="edit-segment-setup">Setup ({{activeSegmentSetupCount}})</button>
    <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
            data-action="edit-segment-landing">Landing ({{activeSegmentLandingCount}})</button>

    {{!-- Segment next --}}
    <label class="cinematic-editor__config-item">
      <span>Next</span>
      <select data-action="change-segment-next" style="min-width:80px">
        <option value="">(end)</option>
        {{#each segmentGraph.nodes}}
        {{#unless isActive}}
        <option value="{{name}}" {{#if (eq name ../activeSegmentNext)}}selected{{/if}}>{{name}}</option>
        {{/unless}}
        {{/each}}
      </select>
    </label>
  </div>

  {{!-- Swimlane area --}}
  <div class="cinematic-editor__swimlane-area">
    {{!-- Fixed left column: lane labels --}}
    <div class="cinematic-editor__lane-labels">
      <div class="cinematic-editor__lane-label--ruler"></div>
      <div class="cinematic-editor__lane-label">Main</div>
      {{#each subLanes}}
      <div class="cinematic-editor__lane-label cinematic-editor__lane-label--branch">{{label}}</div>
      {{/each}}
    </div>

    {{!-- Scrollable swimlane content --}}
    <div class="cinematic-editor__swimlane-scroll">
      <div class="cinematic-editor__swimlane" style="width: {{totalWidthPx}}px; height: {{swimlaneHeightPx}}px;">
        {{!-- Time ruler --}}
        <div class="cinematic-editor__time-ruler">
          {{#each timeMarkers}}<span style="left: {{px}}px;">{{label}}</span>{{/each}}
        </div>

        {{!-- Main lane --}}
        <div class="cinematic-editor__lane cinematic-editor__lane--main">
          {{#each mainBlocks}}
          <div class="cinematic-editor__block cinematic-editor__block--{{type}} {{#if selected}}cinematic-editor__block--selected{{/if}} {{#if isMarker}}cinematic-editor__block--marker{{/if}} {{#if isGate}}cinematic-editor__block--gate{{/if}}"
               style="left: {{leftPx}}px; width: {{widthPx}}px;"
               data-action="select-block" data-entry-path="{{entryPath}}" draggable="true">
            {{#if isGate}}<i class="fa-solid {{gateIcon}}"></i>{{else}}<span class="cinematic-editor__block-label">{{label}}</span>{{/if}}
            {{#if detachTailPx}}
            <div class="cinematic-editor__detach-tail" style="width: {{detachTailPx}}px;"></div>
            {{/if}}
            {{#if hasTrailingArrow}}
            <div class="cinematic-editor__sound-loop-arrow"></div>
            {{/if}}
          </div>
          {{/each}}
        </div>

        {{!-- Sub-lanes (parallel branches) --}}
        {{#each subLanes}}
        <div class="cinematic-editor__lane cinematic-editor__lane--branch">
          {{#each blocks}}
          <div class="cinematic-editor__block cinematic-editor__block--{{type}} {{#if selected}}cinematic-editor__block--selected{{/if}} {{#if isMarker}}cinematic-editor__block--marker{{/if}} {{#if isGate}}cinematic-editor__block--gate{{/if}}"
               style="left: {{leftPx}}px; width: {{widthPx}}px;"
               data-action="select-block" data-entry-path="{{entryPath}}">
            {{#if isGate}}<i class="fa-solid {{gateIcon}}"></i>{{else}}<span class="cinematic-editor__block-label">{{label}}</span>{{/if}}
            {{#if hasTrailingArrow}}
            <div class="cinematic-editor__sound-loop-arrow"></div>
            {{/if}}
          </div>
          {{/each}}
        </div>
        {{/each}}

        {{!-- SVG overlay for signal arcs + F&F connectors --}}
        <svg class="cinematic-editor__arcs" style="width: {{totalWidthPx}}px; height: {{swimlaneHeightPx}}px;">
          {{#each signalArcs}}
          <path d="{{pathD}}" class="cinematic-editor__arc" />
          {{/each}}
          {{#each fafConnectors}}
          <line x1="{{x}}" y1="{{y1}}" x2="{{x}}" y2="{{y2}}" class="cinematic-editor__faf-connector" />
          {{/each}}
        </svg>

        {{!-- Insertion points --}}
        <div class="cinematic-editor__insert-points">
          {{#each insertionPoints}}
          <div class="cinematic-editor__insert-point {{#if isEnd}}cinematic-editor__insert-point--end{{else}}cinematic-editor__insert-point--main{{/if}}"
               style="left: {{leftPx}}px; top: {{topPx}}px;"
               data-action="show-insert-menu" data-insert-index="{{insertIndex}}" data-lane="{{lane}}">
            <i class="fa-solid fa-plus"></i>
          </div>
          {{/each}}
        </div>

        {{!-- Playback cursor (animated via RAF, not Handlebars) --}}
        <div class="cinematic-editor__playback-cursor" style="display:none;"></div>

      </div>
    </div>
  </div>

  {{!-- Insert menu (popover, positioned outside scroll container to avoid clipping) --}}
  <div class="cinematic-editor__insert-menu" style="display: none;">
    <button type="button" data-action="insert-entry" data-insert-type="step">Step</button>
    <button type="button" data-action="insert-entry" data-insert-type="delay">Delay</button>
    <button type="button" data-action="insert-entry" data-insert-type="emit">Emit</button>
    <button type="button" data-action="insert-entry" data-insert-type="parallel">Parallel</button>
    <hr style="margin:0.15rem 0;border:0;border-top:1px solid rgba(0,0,0,0.1)" />
    <button type="button" data-action="insert-entry" data-insert-type="sound">Sound</button>
    <button type="button" data-action="insert-entry" data-insert-type="stopSound">Stop Sound</button>
  </div>

  {{!-- Detail panel --}}
  {{#if detail}}
  <div class="cinematic-editor__detail">
    <div class="cinematic-editor__detail-header">
      {{!-- Setup/Landing detail --}}
      {{#if detail.isSetup}}
        <span class="cinematic-editor__detail-title">Setup</span>
        <span class="cinematic-editor__detail-duration">{{detail.targetCount}} targets</span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
                data-action="edit-setup">Edit JSON</button>
      {{else if detail.isLanding}}
        <span class="cinematic-editor__detail-title">Landing</span>
        <span class="cinematic-editor__detail-duration">{{detail.targetCount}} targets</span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
                data-action="edit-landing">Edit JSON</button>

      {{!-- Delay detail --}}
      {{else if detail.isDelay}}
        <span class="cinematic-editor__detail-title">Delay</span>
        <input type="number" class="cinematic-editor__delay-input" value="{{detail.delay}}"
               data-action="change-delay" min="0" step="100" /> <span>ms</span>
        <span style="flex:1"></span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--danger cinematic-editor__btn--small"
                data-action="delete-entry">Delete</button>

      {{!-- Emit detail --}}
      {{else if detail.isEmit}}
        <span class="cinematic-editor__detail-title">Emit</span>
        <span style="flex:1"></span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--danger cinematic-editor__btn--small"
                data-action="delete-entry">Delete</button>

      {{!-- Sound detail --}}
      {{else if detail.isSound}}
        <span class="cinematic-editor__detail-title">Sound</span>
        <span class="cinematic-editor__detail-duration">{{detail.soundFilename}}</span>
        <span style="flex:1"></span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--danger cinematic-editor__btn--small"
                data-action="delete-entry">Delete</button>

      {{!-- StopSound detail --}}
      {{else if detail.isStopSound}}
        <span class="cinematic-editor__detail-title">Stop Sound</span>
        <span style="flex:1"></span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--danger cinematic-editor__btn--small"
                data-action="delete-entry">Delete</button>

      {{!-- Parallel detail --}}
      {{else if detail.isParallel}}
        <span class="cinematic-editor__detail-title">Parallel</span>
        <span style="flex:1"></span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--danger cinematic-editor__btn--small"
                data-action="delete-entry">Delete</button>

      {{!-- Step detail --}}
      {{else}}
        <span class="cinematic-editor__detail-title">Step {{detail.stepNumber}}</span>
        <span class="cinematic-editor__detail-duration">{{detail.maxDuration}}ms</span>
        <button type="button" class="cinematic-editor__btn cinematic-editor__btn--danger cinematic-editor__btn--small"
                data-action="delete-entry">Delete</button>
      {{/if}}
    </div>

    {{!-- Sound config --}}
    {{#if detail.isSound}}
    <div class="cinematic-editor__entry-config cinematic-editor__entry-config--sound">
      <label class="cinematic-editor__config-item">
        <span>File</span>
        <div class="cinematic-editor__target-group">
          <input type="text" data-action="change-sound-src" value="{{detail.soundSrc}}" placeholder="audio/path.ogg" />
          <button type="button" class="cinematic-editor__btn--icon" data-action="pick-sound-src" title="Browse">
            <i class="fa-solid fa-folder-open"></i>
          </button>
        </div>
      </label>
      <label class="cinematic-editor__config-item">
        <span>ID</span>
        <input type="text" data-action="change-sound-id" value="{{detail.soundId}}" placeholder="(auto)" style="width:80px" />
      </label>
      <label class="cinematic-editor__config-item">
        <span>Volume</span>
        <input type="range" data-action="change-sound-volume" value="{{detail.soundVolume}}" min="0" max="1" step="0.05" style="width:80px" />
        <span style="font-size:0.75rem;width:30px">{{detail.soundVolume}}</span>
      </label>
      <label class="cinematic-editor__config-item">
        <span>Loop</span>
        <input type="checkbox" data-action="change-sound-loop" {{#if detail.soundLoop}}checked{{/if}} />
      </label>
      <label class="cinematic-editor__config-item">
        <span>Fade In</span>
        <input type="number" data-action="change-sound-fadein" value="{{detail.soundFadeIn}}" placeholder="ms" min="0" step="100" style="width:70px" />
      </label>
      <label class="cinematic-editor__config-item">
        <span>Fade Out</span>
        <input type="number" data-action="change-sound-fadeout" value="{{detail.soundFadeOut}}" placeholder="ms" min="0" step="100" style="width:70px" />
      </label>
      <label class="cinematic-editor__config-item">
        <span>Duration</span>
        <input type="number" data-action="change-sound-duration" value="{{detail.soundDuration}}" placeholder="ms" min="0" step="100" style="width:90px" />
        {{#if detail.soundModeForever}}<span style="font-size:0.7rem;opacity:0.6;font-style:italic">loops forever</span>{{/if}}
      </label>
      <label class="cinematic-editor__config-item">
        <span>Fire & Forget</span>
        <input type="checkbox" data-action="change-sound-fireandforget" {{#if detail.soundFireAndForget}}checked{{/if}} />
      </label>
    </div>
    {{/if}}

    {{!-- StopSound config --}}
    {{#if detail.isStopSound}}
    <div class="cinematic-editor__entry-config">
      <label class="cinematic-editor__config-item">
        <span>Sound ID</span>
        <input type="text" data-action="change-stopsound-id" value="{{detail.stopSoundId}}" placeholder="sound id" />
      </label>
    </div>
    {{/if}}

    {{!-- Emit config --}}
    {{#if detail.isEmit}}
    <div class="cinematic-editor__entry-config">
      <label class="cinematic-editor__config-item">
        <span>Signal</span>
        <input type="text" data-action="change-emit-signal" value="{{detail.signal}}" placeholder="signal name" />
      </label>
    </div>
    {{/if}}

    {{!-- Parallel config --}}
    {{#if detail.isParallel}}
    <div class="cinematic-editor__entry-config">
      <label class="cinematic-editor__config-item">
        <span>Branches</span>
        <span>{{detail.branchCount}}</span>
      </label>
      <label class="cinematic-editor__config-item">
        <span>Join</span>
        <select data-action="change-parallel-join">
          <option value="all" {{#if detail.joinIsAll}}selected{{/if}}>All</option>
          <option value="any" {{#if detail.joinIsAny}}selected{{/if}}>Any</option>
        </select>
      </label>
      <label class="cinematic-editor__config-item">
        <span>Overflow</span>
        <select data-action="change-parallel-overflow">
          <option value="detach" {{#if detail.overflowIsDetach}}selected{{/if}}>Detach</option>
          <option value="cancel" {{#if detail.overflowIsCancel}}selected{{/if}}>Cancel</option>
        </select>
      </label>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
              data-action="add-branch">+ Branch</button>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
              data-action="edit-parallel-json">Raw JSON</button>
    </div>
    <div class="cinematic-editor__branches">
      {{#each detail.branches}}
      <div class="cinematic-editor__branch" data-branch-index="{{branchIndex}}">
        <div class="cinematic-editor__branch-header">
          <span class="cinematic-editor__branch-label">{{label}}</span>
          <button type="button" class="cinematic-editor__btn--icon cinematic-editor__btn--danger"
                  data-action="remove-branch" data-branch-index="{{branchIndex}}"
                  title="Remove branch"><i class="fa-solid fa-trash"></i></button>
        </div>
        <div class="cinematic-editor__branch-entries">
          {{#each entries}}
          <div class="cinematic-editor__branch-entry {{#if isDelay}}cinematic-editor__branch-entry--delay{{/if}}{{#if isAwait}}cinematic-editor__branch-entry--await{{/if}}{{#if isEmit}}cinematic-editor__branch-entry--emit{{/if}}{{#if isSound}}cinematic-editor__branch-entry--sound{{/if}}{{#if isStopSound}}cinematic-editor__branch-entry--stopSound{{/if}}{{#if isStep}}cinematic-editor__branch-entry--step{{/if}}"
               data-branch-index="{{../branchIndex}}" data-branch-entry-index="{{branchEntryIndex}}">
            <span class="cinematic-editor__branch-entry-label">{{label}}</span>
            <span class="cinematic-editor__branch-entry-sub">{{sub}}</span>
            <button type="button" class="cinematic-editor__btn--icon cinematic-editor__btn--danger"
                    data-action="remove-branch-entry" data-branch-index="{{../branchIndex}}"
                    data-branch-entry-index="{{branchEntryIndex}}"
                    title="Remove"><i class="fa-solid fa-xmark"></i></button>
          </div>
          {{/each}}
        </div>
        <div class="cinematic-editor__branch-actions">
          <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
                  data-action="add-branch-step" data-branch-index="{{branchIndex}}">+ Step</button>
          <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
                  data-action="add-branch-delay" data-branch-index="{{branchIndex}}">+ Delay</button>
          <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
                  data-action="add-branch-sound" data-branch-index="{{branchIndex}}">+ Sound</button>
          <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
                  data-action="add-branch-stopSound" data-branch-index="{{branchIndex}}">+ Stop</button>
        </div>
      </div>
      {{/each}}
    </div>
    {{/if}}

    {{!-- Step detail (tweens as cards) --}}
    {{#if detail.isStep}}
    {{!-- Before state --}}
    <div class="cinematic-editor__state-row">
      <span class="cinematic-editor__state-label" title="Property snapshots applied to targets before tweens start">Before:</span>
      <span class="cinematic-editor__state-summary">{{detail.beforeSummary}}</span>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
              data-action="edit-before" title="Edit target property overrides (JSON)">Edit Overrides</button>
    </div>

    {{!-- Tween cards --}}
    <div class="cinematic-editor__tweens">
      {{#each detail.tweens}}
      <div class="cinematic-editor__tween-card {{#if isExpanded}}cinematic-editor__tween-card--expanded{{/if}}"
           data-tween-index="{{tweenIndex}}">
        <div class="cinematic-editor__tween-card-summary" data-action="toggle-tween-card" data-tween-index="{{tweenIndex}}">
          <span class="cinematic-editor__tween-card-type">{{typeLabel}}</span>
          <span class="cinematic-editor__tween-card-info">{{#if formIsCamera}}x:{{camX}} y:{{camY}} s:{{camScale}}{{else if formIsLightColor}}{{target}} · {{toColor}} · {{toAlpha}}{{else if formIsLightState}}{{target}} · {{#if enabled}}on{{else}}off{{/if}}{{else}}{{target}} · {{attribute}} · {{value}}{{/if}} · {{duration}}ms</span>
          {{#if easing}}<span class="cinematic-editor__tween-card-easing">{{easing}}</span>{{/if}}
          {{#if detach}}<i class="fa-solid fa-link-slash" title="Detached" style="opacity:0.5;font-size:0.72rem"></i>{{/if}}
          <button type="button" class="cinematic-editor__tween-card-toggle"><i class="fa-solid fa-chevron-down"></i></button>
          <button type="button" class="cinematic-editor__btn--icon cinematic-editor__btn--danger"
                  data-action="delete-tween" data-tween-index="{{tweenIndex}}"
                  style="width:22px;height:22px;font-size:0.72rem"><i class="fa-solid fa-trash"></i></button>
        </div>
        {{#if isExpanded}}
        <div class="cinematic-editor__tween-card-body" data-tween-index="{{tweenIndex}}">
          {{!-- Type dropdown (always) --}}
          <div class="cinematic-editor__tween-field">
            <label>Type</label>
            <select data-field="type">
              {{#each typeOptions}}<option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>{{/each}}
            </select>
          </div>

          {{!-- prop: Target + Attribute + Value --}}
          {{#if formIsProp}}
          <div class="cinematic-editor__tween-field">
            <label>Target</label>
            <div class="cinematic-editor__tween-target-group">
              <input type="text" data-field="target" value="{{target}}" placeholder="(none)" readonly />
              <button type="button" data-action="pick-target" data-tween-index="{{tweenIndex}}"
                      title="Pick target"><i class="fa-solid fa-crosshairs"></i></button>
            </div>
          </div>
          <div class="cinematic-editor__tween-field-row">
            <div class="cinematic-editor__tween-field">
              <label>Attribute</label>
              <input type="text" data-field="attribute" value="{{attribute}}" placeholder="{{attributePlaceholder}}" />
            </div>
            <div class="cinematic-editor__tween-field">
              <label>Value</label>
              <input type="text" data-field="value" value="{{value}}" />
            </div>
          </div>

          {{!-- particles: Attribute + Value (no target) --}}
          {{else if formIsParticles}}
          <div class="cinematic-editor__tween-field-row">
            <div class="cinematic-editor__tween-field">
              <label>Attribute</label>
              <input type="text" data-field="attribute" value="{{attribute}}" placeholder="{{attributePlaceholder}}" />
            </div>
            <div class="cinematic-editor__tween-field">
              <label>Value</label>
              <input type="text" data-field="value" value="{{value}}" />
            </div>
          </div>

          {{!-- camera: X + Y + Scale --}}
          {{else if formIsCamera}}
          <div class="cinematic-editor__tween-field-row">
            <div class="cinematic-editor__tween-field">
              <label>X</label>
              <input type="number" data-field="x" value="{{camX}}" step="1" />
            </div>
            <div class="cinematic-editor__tween-field">
              <label>Y</label>
              <input type="number" data-field="y" value="{{camY}}" step="1" />
            </div>
            <div class="cinematic-editor__tween-field">
              <label>Scale</label>
              <input type="number" data-field="scale" value="{{camScale}}" min="0.1" step="0.1" />
            </div>
          </div>

          {{!-- lightColor: Target + Color + Alpha + Mode --}}
          {{else if formIsLightColor}}
          <div class="cinematic-editor__tween-field">
            <label>Target</label>
            <div class="cinematic-editor__tween-target-group">
              <input type="text" data-field="target" value="{{target}}" placeholder="(none)" readonly />
              <button type="button" data-action="pick-target" data-tween-index="{{tweenIndex}}"
                      title="Pick target"><i class="fa-solid fa-crosshairs"></i></button>
            </div>
          </div>
          <div class="cinematic-editor__tween-field-row">
            <div class="cinematic-editor__tween-field">
              <label>Color</label>
              <input type="color" data-field="toColor" value="{{toColor}}" />
            </div>
            <div class="cinematic-editor__tween-field">
              <label>Alpha</label>
              <input type="number" data-field="toAlpha" value="{{toAlpha}}" min="0" max="1" step="0.05" placeholder="(unchanged)" />
            </div>
            <div class="cinematic-editor__tween-field">
              <label>Mode</label>
              <select data-field="mode">
                <option value="oklch" {{#if colorModeIsOklch}}selected{{/if}}>OKLCH</option>
                <option value="hsl" {{#if colorModeIsHsl}}selected{{/if}}>HSL</option>
                <option value="rgb" {{#if colorModeIsRgb}}selected{{/if}}>RGB</option>
              </select>
            </div>
          </div>

          {{!-- lightState: Target + Enabled --}}
          {{else if formIsLightState}}
          <div class="cinematic-editor__tween-field">
            <label>Target</label>
            <div class="cinematic-editor__tween-target-group">
              <input type="text" data-field="target" value="{{target}}" placeholder="(none)" readonly />
              <button type="button" data-action="pick-target" data-tween-index="{{tweenIndex}}"
                      title="Pick target"><i class="fa-solid fa-crosshairs"></i></button>
            </div>
          </div>
          <label class="cinematic-editor__tween-detach" style="margin-top:0.25rem">
            <input type="checkbox" data-field="enabled" {{#if enabled}}checked{{/if}} />
            Enabled
          </label>
          {{/if}}

          {{!-- Duration + Easing (always) --}}
          <div class="cinematic-editor__tween-field-row">
            <div class="cinematic-editor__tween-field">
              <label>Duration (ms)</label>
              <input type="number" data-field="duration" value="{{duration}}" min="0" step="100" />
            </div>
            <div class="cinematic-editor__tween-field">
              <label>Easing</label>
              <select data-field="easing">
                {{#each easingOptions}}<option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>{{/each}}
              </select>
            </div>
          </div>
          {{!-- Detach (always) --}}
          <label class="cinematic-editor__tween-detach">
            <input type="checkbox" data-field="detach" {{#if detach}}checked{{/if}} />
            Detach (fire-and-forget)
          </label>
        </div>
        {{/if}}
      </div>
      {{/each}}
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small" data-action="add-tween">+ Add Effect</button>
    </div>

    {{!-- After state --}}
    <div class="cinematic-editor__state-row">
      <span class="cinematic-editor__state-label" title="Property snapshots applied to targets after tweens complete">After:</span>
      <span class="cinematic-editor__state-summary">{{detail.afterSummary}}</span>
      <button type="button" class="cinematic-editor__btn cinematic-editor__btn--small"
              data-action="edit-after" title="Edit target property overrides (JSON)">Edit Overrides</button>
    </div>
    {{/if}}
  </div>
  {{/if}}

  {{!-- Footer: config + stats --}}
  <footer class="cinematic-editor__footer">
    <div class="cinematic-editor__footer-config">
      <label class="cinematic-editor__config-item">
        <span>Trigger</span>
        <select data-action="change-trigger">
          {{#each triggerOptions}}
          <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
          {{/each}}
        </select>
      </label>
      <label class="cinematic-editor__config-item">
        <span>Track Seen</span>
        <input type="checkbox" data-action="change-tracking" {{#if tracking}}checked{{/if}} />
      </label>
      <label class="cinematic-editor__config-item">
        <span>Synced</span>
        <input type="checkbox" data-action="change-synchronized" {{#if synchronized}}checked{{/if}} />
      </label>
    </div>
    <div class="cinematic-editor__footer-stats">
      {{#if dirty}}<span class="cinematic-editor__footer-dirty">Unsaved</span>{{/if}}
      <span>{{entryCount}} entries</span>
      <span>{{totalDuration}}ms</span>
    </div>
  </footer>
</div>
